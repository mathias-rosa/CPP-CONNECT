{% extends 'base.html' %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/connected_styles.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='styles/notes_styles.css') }}">
<script src="{{ url_for('static', filename='script/swiped-events.min.js') }}"></script>
<title>Notes</title>

{% endblock %}

{% block content %}

<div class="content" 
    x-data="{notesSemestre : {}, selSemestre: 1, indexCounter : 0, noteCounter : 0, icon : 'drive_file_rename_outline',  consultation: true}" 
    x-init="notesSemestre = await getNotes()">

    <h1 id="title">Visualisation des notes (en cours de réalisation)</h1>

    <div class="semester-gepi">
        <div class="semester-div">
            <button x-on:click="selSemestre = 1 ; changeColor(selSemestre) " class="semester" id="semester1" autofocus>
                Semestre 1 
            </button>
            <button x-on:click="selSemestre = 2 ; changeColor(selSemestre)" class="semester" id="semester2">
                Semestre 2
            </button>
            <button x-on:click="selSemestre = 3 ; changeColor(selSemestre)" class="semester" id="semester3">
                Semestre 3
            </button>
            <button x-on:click="selSemestre = 4 ; changeColor(selSemestre)" class="semester" id="semester4">
                Semestre 4
            </button>

        </div>


        <input type="hidden" x-model="selSemestre" id="SemesterVar"></input>

    </div>

    <h2 class="mobile-text" id="#tooltip" style="display: none;"
        x-on:swiped-right="
        selSemestre === 1 ? selSemestre = 4 : selSemestre--;
         
        " 
        x-on:swiped-left="
        selSemestre === 4 ? selSemestre = 1 : selSemestre++;
        changeColor(selSemestre)
        " >
            (Swippez pour changer de semestre)
        </h2>

    <div class="notes_et_graphes" 
    x-on:swiped-right="
    selSemestre === 1 ? selSemestre = 4 : selSemestre--;
    changeColor(selSemestre)
    " 
    x-on:swiped-left="
    selSemestre === 4 ? selSemestre = 1 : selSemestre++;
    changeColor(selSemestre)
    " >

        <div class="notes-container">
            <template x-for="semestre in [1, 2, 3, 4]">

                <div class="notes" 
                    x-show="selSemestre === semestre"

                    x-transition:enter.ease-out.duration.400ms
                    x-transition:enter-start.opacity.0
                    x-transition:enter-start.scale.90
                    x-transition:enter-end.opacity.100
                    x-transition:enter-end.scale.100

                >
    
                    <div class="top">
                        <div class="titre-notes" x-on:click="selSemestre === 4 ? selSemestre = 1 : selSemestre++;">  
                            <h1 x-html="'Semestre ' + semestre"></h1>
                            <i class="material-icons-outlined">
                                arrow_forward_ios
                            </i>
                        </div>
                        <button @click="add = true; consultation === true ? consultation = false : consultation = true; consultation ? icon = 'drive_file_rename_outline' : icon = 'done' ;">
                            <i class="material-icons-round" x-text="icon"></i>
                        </button>
                    </div>
                    
                    <div class="moyenne" id="generale" >
                        
                        <h1 class="moyenne_name">Moyenne Générale</h1>
                        <div class="note-mg">
                            <h1 x-text="notesSemestre['semestre'+ semestre]['moyenne']"></h1>
                        </div>
            
                    </div>
        
                    <button class="ajouter-matière"
                                x-show="!consultation"
                                x-transition:enter.duration.300ms
                                x-transition:leave.duration.200ms>
                                Ajouter une matière 
                                <i class="material-icons-round">post_add</i>
                    </button>
        
                    <template x-for="matiere in notesSemestre['semestre'+ semestre]['notes']" >
        
                        <div class="matiere">
            
                            <div class="moyenne">
                                
                                <h1 class="moyenne_name" x-text="matiere.name"></h1>
                                <div class="notes-coef">
                                    <h1 class="coef" x-text="'coef : ' + matiere.coef"></h1>
                                    <div class="note-mg">
                                        <h1 x-text="matiere.moyenne"></h1>
                                    </div>
                                </div>
             
                            </div>
        
                            <div class="list-notes">
        
                                <template x-for="note in matiere.notes">
        
                                    <div class="note_container">
                                        <h1 class="nom_note" x-text="note.name"></h1>
                                        <div class="notes-coef">
                                            <h1 class="coef" x-text="'coef : ' + note.coef"></h1>
                                            <h1 class="note" x-text="note.note"></h1>
                                        </div>
                                       
                                        <div style="display: none;" class="path" x-text="'notesSemestre[\'semestre' + semestre + '\'][\'notes\'][\'' + indexCounter + '\'][\'notes\'][\'' + noteCounter + '\']'"></div>
                                    </div>
        
                
                                </template>
                            </div>
                
                            <button class="ajouter-matière"
                                x-show="!consultation"
                                x-transition:enter.duration.300ms
                                x-transition:leave.duration.200ms>
                                Ajouter une note
                                <i class="material-icons-round">description</i>
                            </button>
                
                        </div>
                
        
                      </template>
            
                </div>
            </template>  
        </div>
    
    
        <div class="graphe_moyennes" 
        
            x-transition:enter.ease-out.duration.400ms
            x-transition:enter-start.opacity.0
            x-transition:enter-start.scale.90
            x-transition:enter-end.opacity.100
            x-transition:enter-end.scale.100
        >
    
        </div>

    </div>

    
</div>

<script src="{{ url_for('static', filename='script/graphique_notes.js') }}" type="module"></script>
<script>

    async function getNotes() {
        let notes = fetch("{{ url_for('update_notes') }}")
        .then((response) => response.json())
        .then((responseJSON) => {return responseJSON});
        window.localStorage.setItem("notesSemestre", JSON.stringify(await notes));
        return await notes;
    }

    function changeColor(selSemestre) {
        document.querySelectorAll('.semester').forEach((e) => {
            e.style.backgroundColor = 'hsl(var(--second-accent-color))'; 
        });
        document.querySelector('#semester' + selSemestre).style.backgroundColor = 'hsl(var(--accent-color))';
        try {
            afficheNotes(selSemestre);
        }
        catch {
            return "afficheNotes n'est pas encore chargée"
        }

    }

    changeColor("1")



</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.8.0/chart.min.js" integrity="sha512-sW/w8s4RWTdFFSduOTGtk4isV1+190E/GghVffMA9XczdJ2MDzSzLEubKAs5h0wzgSJOQTRYyaz73L3d6RtJSg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/1.4.0/chartjs-plugin-annotation.min.js" integrity="sha512-HrwQrg8S/xLPE6Qwe7XOghA/FOxX+tuVF4TxbvS73/zKJSs/b1gVl/P4MsdfTFWYFYg/ISVNYIINcg35Xvr6QQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

{% endblock %}
