{% extends 'base.html' %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/connected_styles.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='styles/notes_styles.css') }}">
<title>Notes</title>
{% endblock %}

{% block content %}

<div class="content" x-data="{visible: false}">

    <h1 id="title">Fonctionnalité non implémentée, ça arrive bientôt !</h1>

<!---

    <div class="semester-gepi">
        <div class="semester-div">
            <a href="{{ url_for('notes') }}" class="semester">
                <div><h1>Semestre 1</h1></div>
            </a>
            <a href="{{ url_for('notes') }}" class="semester">
                <div><h1>Semestre 2</h1></div>
            </a>
            <a href="{{ url_for('notes') }}" class="semester">
                <div><h1>Semestre 3</h1></div>
            </a>
        </div>
        <button class="gepi" @click="GEPI()">
            <h1>Télécharger les notes de GEPI</h1>
            <i class="material-icons-round">
                file_download
            </i>
        </button>
    </div>


    <div class="popup" x-show="visible === true">
        <form x-data="{ username : '', password : ''}" class="gepi-form" autocomplete="gepi">
            <h1>Connection à gepi</h1>
            <div id="gepi-username">
                <h2>Nom d'utilisateur GEPI</h2>
                <input type="text" x-model="username" name="gepi-username" placeholder="Nom d'utilisateur GEPI" required>
                <p style="display: none;" x-text="username">
            </div>
            <div id="gepi-password">
                <h2>Mot de passe GEPI</h2>
                <input type="password" x-model="password" @keydown.enter="GEPI()" name="gepi-password" placeholder="Mot de passe GEPI" autocomplete="new-password" required>
                <p style="display: none;" x-text="password">
            </div>
            <div class="buttons">
                <button id="download" type="button" @click="GEPI()">Télécharger mes notes</button>
                <button id="cancel" type="button" @click="document.querySelector('.content').__x.$data.visible = false">Annuler</button>
            </div>
        </form>
    </div>

--->

</div>

<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
<script>

function createCookie(obj) {
    /**
    Fonction qui crée un cookie contenant le nom d'utilisateur gepi et son mot de passe
     * @param  {[object]} obj {
         UserID: "Gepi id"
         password: "Gepi password"
     }
     */
    document.cookie = `GEPI={UserID: ${obj.UserID}, password: ${obj.password}}`
}

function GEPI() {

    if (document.cookie) {
        document.querySelector(".content").__x.$data.visible = false;
        console.log(document.cookie)
    } else {

        document.querySelector(".content").__x.$data.visible = true;

        let gepiID = document.querySelector("#gepi-username p").textContent
        let gepiPassword = document.querySelector("#gepi-password p").textContent
        if (gepiID !== "" && gepiPassword !== " ") {
            createCookie({
                UserID: gepiID,
                password: gepiPassword
            })
        }
    }

}


</script>

{% endblock %}
