{% extends 'base.html' %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/connected_styles.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='styles/notes_styles.css') }}">
<title>Notes</title>
{% endblock %}

{% block content %}

<div class="content" x-data="{visible: false}">

    <h1 id="title">Visualisation des notes (en cours de réalisation)</h1>

    <div class="semester-gepi">
        <!---div class="semester-div">
            <a href="{{ url_for('notes') }}" class="semester">
                <div><h1>Semestre 1</h1></div>
            </a>
            <a href="{{ url_for('notes') }}" class="semester">
                <div><h1>Semestre 2</h1></div>
            </a>
            <a href="{{ url_for('notes') }}" class="semester">
                <div><h1>Semestre 3</h1></div>
            </a>
        </div--->
        <button class="gepi" @click="visible = true">
            <h1>Télécharger les notes de GEPI</h1>
            <i class="material-icons-round">
                file_download
            </i>
        </button>
    </div>

    <div class="notes">
        <div class="titre-notes">  
            <h1>Notes</h1>
        </div>
        <div class="moyenne" id="generale">
            
            <h1>Moyenne Générale</h1>
            <div class="note-mg">
                <h1>N.I</h1>
            </div>

        </div>

        {%  for matiere in notes %}

        <div class="matiere">

            <div class="moyenne">

                <h1>{{ matiere }}</h1>
                <div class="note-mg">
                    <h1> 
                        {% for note in notes[matiere] %} 

                            {% if note is iterable %}
                                {{ note[0] }}
                            {% endif %}

                        {% endfor %}

                    </h1>

                </div>

            </div>

            <div class="list-notes">
                {% for note in notes[matiere] %} 

                    <h1>
                        {% if note is float %}
                        {{ note }}
                    {% endif %}
                    </h1>


                {% endfor %}
            </div>
            
        </div>

        {%  endfor %}


    </div>

    <div class="popup" x-show="visible === true">
        <form x-data="{ gepiLogin : '', gepiPassword : ''}" x-on:submit.prevent="getNotesFromGepi(gepiLogin, gepiPassword)" class="gepi-form" autocomplete="gepi">
            <h1>Connection à gepi</h1>
            <div id="gepi-username">
                <h2>Nom d'utilisateur GEPI</h2>
                <input type="text" x-model="gepiLogin" name="gepi-username" placeholder="Nom d'utilisateur GEPI" required>
                <p style="display: none;" x-text="gepiLogin">
            </div>
            <div id="gepi-password">
                <h2>Mot de passe GEPI</h2>
                <input type="password" x-model="gepiPassword" name="gepi-password" placeholder="Mot de passe GEPI" autocomplete="new-password" required>
                <p style="display: none;" x-text="gepiPassword">
            </div>
            <div class="buttons">
                <button id="download" @click="visible = false">Télécharger mes notes</button>
                <button id="cancel" type="button" @click="visible = false">Annuler</button>
            </div>
        </form>
    </div>

</div>

<script>


function getNotesFromGepi(gepiLogin, gepiPassword){
    
        let url = "{{ baseURL }}" + "/get_notes";
        url = url + "?GEPI_LOGIN=" + gepiLogin;
        url = url + "&GEPI_PASSWORD=" + gepiPassword;
    
        console.log(url)

        return fetch(url)
        .then((promise) => {
            promise.json().then( (resp) => {
                console.log(resp)
            })
        })
        .catch( (err) => {
            console.log(err);
        });
}


</script>

{% endblock %}
